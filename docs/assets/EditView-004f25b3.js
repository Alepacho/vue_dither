import{d as D,r as R,a as V,u as L,o as M,b as O,c as f,e as v,f as X,g as x,w as b,h as y,B as C,i as l,F as j,p as H,j as z,_ as G}from"./index-4f512428.js";var k=(e=>(e[e.MONOCHROME=0]="MONOCHROME",e[e.ORDERED_2X2=1]="ORDERED_2X2",e[e.UNKNOWN=2]="UNKNOWN",e))(k||{});const T=D("effect",()=>{const e=R(!1),h=()=>{e.value=!1},_=s=>new Promise(o=>{const a=new Image;a.onload=()=>{o(a)},a.src=s}),g=s=>{const o=document.createElement("canvas"),a=s.width,i=s.height;o.width=a,o.height=i;const c=o.getContext("2d");if(!c){console.warn("no CTX!");return}return c.clearRect(0,0,a,i),c.drawImage(s,0,0),c.getImageData(0,0,a,i)},m=s=>{const o=document.createElement("canvas"),a=s.width,i=s.height;o.width=a,o.height=i;const c=o.getContext("2d");if(!c){console.warn("no CTX!");return}return c.clearRect(0,0,a,i),c.putImageData(s,0,0),o.toDataURL()};return{processing:e,cancel:h,dither:async(s,o)=>(console.log("dither",{mode:s,url:o}),e.value=!0,new Promise(async a=>{const i=[[1,9,3,11],[13,5,15,7],[4,12,2,10],[16,8,14,6]],c=4,d=15+1,n=await _(o),t=g(n);if(!t){console.warn("Can't get image data!"),e.value=!1,a(void 0);return}const S=t.height*t.width*4;console.log({img:n,imageData:t,dataSize:S});for(let w=0;w<t.height;w++)for(let p=0;p<t.width;p++){const u=(w*t.width+p)*4,I={r:t.data[u+0],g:t.data[u+1],b:t.data[u+2]},B=i[p%c][w%c],N=I.r*.3+I.g*.59+I.b*.11>B*255/d?255:0;t.data[u+0]=N,t.data[u+1]=N,t.data[u+2]=N}const U=m(t);e.value=!1,a(U)}))}}),E=e=>(H("data-v-2a1b886b"),e=e(),z(),e),F={key:0,class:"loading flex flex-col z-30"},K=E(()=>l("h2",{class:"text-border text-white font-bold flex flex-row mb-10"},"Loading...",-1)),P={key:1},W={class:"navbar justify-between mb-3"},q={class:"flex"},A=E(()=>l("option",null,"monochrome",-1)),J=[A],Q={key:2},Y=E(()=>l("h3",null,"Generated Image:",-1)),Z={class:"flex justify-center my-3"},$=["src"],ee={key:3},te=E(()=>l("h3",null,"Original Image:",-1)),oe={class:"flex justify-center my-3"},ae=["src"],ne=V({__name:"EditView",setup(e){const h=L(),_=T(),g=R(""),m=R(k.MONOCHROME),r=R(void 0);M(()=>{if(h.imageURL==null){console.log("image is null"),O.push({name:"home"});return}g.value=h.imageURL});const s=()=>{console.log("goin back"),h.clear(),O.push({name:"home"})},o=d=>{console.log("handleSelect",d);const n=d.target;switch(n.value){case"monochrome":m.value=k.MONOCHROME;break;case"ordered 2x2":m.value=k.ORDERED_2X2;break;default:console.warn("Unknown Mode:",n.value)}},a=d=>{_.dither(m.value,g.value).then(n=>{console.log({res:n});const t=n;r.value=t}).catch(n=>{console.warn("Unable to apply dither effect:",n)})},i=d=>{if(r.value==null){console.warn("no generated image!");return}var n=document.createElement("a");n.href=""+r.value,n.download="result.png",n.click()},c=()=>{_.cancel()};return(d,n)=>(f(),v(j,null,[X(_).processing==!0?(f(),v("div",F,[K,x(C,{class:"flex flex-row",onClick:c},{default:b(()=>[y(" Cancel ")]),_:1})])):(f(),v("div",P)),l("div",W,[l("div",q,[l("select",{class:"m-1",onChange:o},J,32),x(C,{class:"m-1",onClick:a},{default:b(()=>[y(" Generate ")]),_:1}),x(C,{class:"m-1",onClick:i,disabled:r.value==null},{default:b(()=>[y(" Save ")]),_:1},8,["disabled"])]),x(C,{class:"flex m-1",onClick:s},{default:b(()=>[y(" Exit ")]),_:1})]),r.value!=null?(f(),v("div",Q,[Y,l("div",Z,[l("img",{style:{"image-rendering":"pixelated"},src:r.value},null,8,$)])])):(f(),v("div",ee)),te,l("div",oe,[l("img",{style:{"image-rendering":"pixelated"},src:g.value},null,8,ae)])],64))}});const le=G(ne,[["__scopeId","data-v-2a1b886b"]]);export{le as default};
